---
title: "Interaction and Telemarketers"
class_no: 14
class_date: "Thurs. February 23"
qrimage: qrcode.png
qrbottom: '-90%'
pageurl: "ees4760.jonathangilligan.org/Slides/Class_14"
pdfurl: "ees4760.jonathangilligan.org/Slides/Class_14/EES_4760_5760_Class_14_Slides.pdf"
course      : "EES 4760/5760"
course_name : "Agent-Based & Individual-Based Computational Modeling"
author      : "Jonathan Gilligan"
semester    : Spring
year        : 2017
output:
  revealjs.jg::revealjs_presentation
---
```{r utility_functions, cache = F, echo = F, eval = T, message=F, warning=F}
knitr::opts_chunk$set(cache=TRUE, fig.height=10, fig.width=18, dpi=105,
                      dev='png',fig.path='assets/fig/',cache.path='./cache/')

find_semester_dir <- function(p = NULL) {
  if (is.null(p)) p <- getwd()
  p <- normalizePath(p)
  if (file.exists(file.path(p,'semester.yml'))) {
    return(p)
  } else {
    d <- dirname(p)
    if (d == p) return(NA)
    return(find_semester_dir(d))
  }
}

semester.dir <- find_semester_dir()
data.dir <- file.path('assets', 'data')
script.dir <- file.path(semester.dir,'util_scripts')

source_semester_script <- function(script) {
  script_file <- file.path(script.dir, script)
  message("Running script", script_file)
  source(script_file, chdir = T)
}

eval_in_sem_script_dir <- function(expr, loc = script.dir) {
  this.dir <- getwd()
  setwd(loc)
  retval <- eval(expr)
  setwd(this.dir)
  invisible(retval)
}

library(magrittr)
library(stringr)
library(tidyverse)
```
## Getting Started {#getting-started}

* Download the following files:
    * [https://ees4760.jonathangilligan.org/models/class_14/jg-tif.nls](https://ees4760.jonathangilligan.org/models/class_14/jg-tif.nls)

    * [https://ees4760.jonathangilligan.org/models/class_14/<br/>telemarketer_class_14.nlogo](https://ees4760.jonathangilligan.org/models/class_14/telemarketer_class_14.nlogo)

    * [https://ees4760.jonathangilligan.org/models/class_14/<br/>telemarketer_mergers_class_14.nlogo](https://ees4760.jonathangilligan.org/models/class_14/telemarketer_mergers_class_14.nlogo)

    * [https://ees4760.jonathangilligan.org/models/class_14/<br/>telemarketer_class_14%20vary_initial_telemarketers-table.csv](https://ees4760.jonathangilligan.org/models/class_14/telemarketer_class_14%20vary_initial_telemarketers-table.csv)

    * [https://ees4760.jonathangilligan.org/models/class_14/<br/>telemarketer_mergers_class_14%20vary_initial_telemarketers-table.csv](https://ees4760.jonathangilligan.org/models/class_14/telemarketer_mergers_class_14%20vary_initial_telemarketers-table.csv)

# Business Investors {#investor-sec data-transition="fade-out" data-state="skip_slide"}

## Business Investors {.ninety}

* Expected utility function: 
  $$U = (W + PT) \times (1 - F)^T$$

    W = wealth, P = profit, F = risk of failure, T = time horizon

* How does this change as investors gain more wealth?

* Interactive app <https://ees4760.jonathangilligan.org/contour>

<div  style="padding-top:50px;">
<iframe height=500 width=1800 src="https://ees4760.jonathangilligan.org/contour">
Open app at <https://ees4760.jonathangilligan.org/contour>
</iframe>
</div>


# Telemarketer Model {#telemarketer-sec data-transition="fade-out" data-state="skip_slide"}

## Telemarketer Model {#telemarketer data-transition="fade-in"}

* Telemarketing firms interact
    * Telemarketer calls patches
    * If patch has received a previous call that tick, it hangs up
    * If patch has not received a previous call that tick, it buys something
    * Interaction is indirect, mediated by patches
* Accounting:
    * Net profit = 2 &times; sales &minus; 50 &times; size
    * If balance < 0, firm goes bankrupt
* Growth
    * If balance > growth threshold, firm increases size proportional to excess balance

# Results {#tm-results-sec data-transition="fade-out" data-state="skip_slide"}

## Results {#results data-transition="fade-in"}

```{r load_data, echo=F, include=T, message = F}
source_semester_script('analyze_telemarketer.R')
expt_data <- read_data(file.path(data.dir, 'telemarketer_class_14 vary_initial_telemarketers-table.csv')) %>% fix_names()
merger_data <- read_data(file.path(data.dir, 'telemarketer_mergers_class_14 vary_initial_telemarketers-table.csv')) %>% fix_names()
```
```{r time_series, echo=F, include=T, message = F, fig.height=9}
plot_time_series(expt_data)
```

## Variation {#tm-variation}

```{r time_series_bands, echo=F, include=T, message = F, fig.height=9}
plot_time_series(expt_data, bands = TRUE)
```

## Median Weeks in Business {#tm-median-weeks}

```{r median_lifetime, echo=F, include=T, warning=F, fig.height=9}
plot_median_weeks(expt_data, max_weeks = 125, bands = TRUE)
```

# Mergers {#merger-sec data-transition="fade-out" data-state="skip_slide"}

## Mergers {#mergers data-transition="fade-in"}

* Instead of going bankrupt when the bank balance drops below 0, firms look for acquisition partner
    * Find a company that's bigger and has enough money to pay off deficit.
    * If it finds a parent, parent pays off deficit (child firm ends up with 0 balance)
    * In future turns, child pays parent 50% of its net profits.
    * In future, if child's balance becomes negative:
        * If parent has enough money, it pays child's deficit
        * If parent does not have enough money, child dies.


## Results {#merger-results}

```{r time_series_merger_bands, echo=F, include=T, fig.height=9}
plot_time_series(merger_data)
```

## Variation {#merger-variation}

```{r time_series_merger, echo=F, include=T, fig.height=9}
plot_time_series(merger_data, bands = TRUE)
```

## Median Weeks in Business {#merger-median-weeks}

```{r median_lifetime_merger, echo=F, include=T, warning=F, fig.height=9}
plot_median_weeks(merger_data, max_weeks = 125, bands = TRUE)
```
