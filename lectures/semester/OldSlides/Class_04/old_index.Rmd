---
title: "Designing and Documenting Models"
class_no: 4
class_date: "Thurs. January 19"
qrimage: qrcode.png
qrbottom: '-90%'
pageurl: "ees4760.jonathangilligan.org/Slides/Class_04"
course      : "EES 4760/5760"
course_name : "Agent-Based & Individual-Based Computational Modeling"
author      : "Jonathan Gilligan"
semester    : Spring
year        : 2017
output:
  revealjs.jg::revealjs_presentation
---
```{r utility_functions, cache = F, echo = F, eval = T, message=F, warning=F}
knitr::opts_chunk$set(cache=TRUE, fig.height=10, fig.width=18, dpi=105,
                      dev='png',fig.path='assets/fig/',cache.path='./cache/')

find_semester_dir <- function(p = NULL) {
  if (is.null(p)) p <- getwd()
  p <- normalizePath(p)
  if (file.exists(file.path(p,'semester.yml'))) {
    return(p)
  } else {
    d <- dirname(p)
    if (d == p) return(NA)
    return(find_semester_dir(d))
  }
}

semester.dir <- find_semester_dir()
data.dir <- file.path(semester.dir, 'data')
script.dir <- file.path(semester.dir,'util_scripts')

source_semester_script <- function(script) {
  script_file <- file.path(script.dir, script)
  message("Running script", script_file)
  source(script_file, chdir = T)
}

eval_in_sem_script_dir <- function(expr, loc = script.dir) {
  this.dir <- getwd()
  setwd(loc)
  retval <- eval(expr)
  setwd(this.dir)
  invisible(retval)
}

library(magrittr)
library(stringr)
library(tidyverse)
```
# Housekeeping at Start of Class: {#housekeeping-sec data-transition="fade-out" data-state="skip_slide"}

# Getting Started: {#getting-started data-transition="fade-in"}

Today's slides are at <https://ees4760.jonathangilligan.org/Slides/Class_04>

<hr style="padding-top:50px;padding-bottom:50px;"/>

Download and save the Butterfly model from <https://ees4760.jonathangilligan.org/models/butterfly.nlogo>

## Designing and Documenting Models

## Designing and Documenting Models

<img src="images/odd_paper.png", style="height:800px;"/>

***

* **Design:** Don't start writing code until you know what you're trying to do.

* .fragment Big picture
    * .fragment What is the **purpose** of your model?
    * .fragment What **things** does your model use?
    * .fragment How do those things **behave**?
* .fragment Design concepts
    * .fragment How do you represent the **things** in your model?
    * .fragment How do you implement their **behavior**?
    * .fragment How will your **things** and **behaviors** realize your **purpose**?
    * .fragment What **data** will you collect from your model?
    * .fragment How will you **use that data** to achieve your **purpose**?

***
## Overview, Design Concepts, and Details

<table style="vertical-align:middle;margin-top:50px;">
<tr><td>
<img src="images/odd_diagram.png" style="height:800px;"/>
</td><td style="vertical-align:middle;">
<p>General</p>
<img src="images/arrow.png" style="height:600px;border:none;box-shadow:none;"/>
<p>Detailed</p>
</td></tr>
</table>

***
## ODD in perspective:

* Write overview and major parts of design concepts *first*
* As you write the model code, revisit and revise design concepts.
* Much of the details will emerge in the course of programming.
* When you are finished, write a complete ODD. This will be the major 
documentation for your model.

--- &vertical
## 1. Purpose

*Question:* What is the **purpose** of the model?


---
## 2. Entities, State Variables, Scale

* .fragment What kinds of **entities** are in the model?<br/>
      Agents, collectives, spatial units, global environment, ...
* .fragment What attributes (state-variables) characterize the entities?<br/>
      Age, sex, wealth, mood, opinion, soil type, land costs, rainfall, market price, ...
* .fragment What are the temporal and spatial resolutions and extents of the model?

---
## 3. Process Overview and Scheduling

* .fragment How do states change?
* .fragment What entities do what, and in what order?
    * .fragment Schedule:
        1. Which entities take actions?
        2. What actions do they take?
        3. In what order do they take them?
* .fragment How is time modeled?
    * Discrete steps?
    * Continuum, with both continuous processes and discrete events?

--- &vertical .center
## 4. Design Concepts

There are **11 design concepts**. One chapter for each in the textbook.

*** .ninety
## Outline of Design Concepts

* .fragment **Basic Principles:**  Basis of model in general concepts and theories
* .fragment **Emergence:** What emerges as the model runs?<br/>
  (phenomena not imposed or directly programmed)
* .fragment **Adaptation** How do agents adapt, improve fitness?
* .fragment **Objectives (Fitness):** Goals of agents? What determines survival? 
* .fragment **Learning:** Do individuals change behavior as they gain experience?
* .fragment **Prediction:** How do agents predict consequences of their decisions?<br/>
  (learning, memory, environmental cues, programmed assumptions)
* .fragment **Sensing:** What do agents know or perceive when making decisions?<br/>
  (Is sensing process itself explicitly modelled?)
* .fragment **Interaction:** What forms of interaction among agents are there?
* .fragment **Stochasticity:** Is there randomness in model?<br/>
  **Randomness must be justified!**
* .fragment **Collectives:** Grouping of individuals
* .fragment **Observation:** How are data collected from model for analysis?

--- &vertical .center
# Details

***
## 5. Initialization

* What is the initial state of the model world?

* Time \\(t = 0\\) of a simulation run

* In detail: 
    * How many entities, of what type, are there initially?
    * What are the exact values of their state variables?<br/>
      (Or how were they set at random?)
    * Is initialization always the same,<br/>
      or does it vary from one simulation run to the next?
    * Are initial values chosen arbitrarily, or based on data?
    * References to those data should be provided.

***
## Input data
<br/>

Does the model use input from external sources<br/>
(data files, other models, human interaction)<br/>
to represent processes that change over time?

If so, what data? 

Where did they come from? 

Provide references, citations.

*** 
## 7. Submodels
<br/>

If the **process scheduling** step contains a list of processes,<br/>
explain, in detail what **submodels** represent those processes.

What are the model parameters?

How were the submodels designed or chosen?

How were they tested?

--- &vertical
## Example: Virtual Corridors for Conservation Management

<img src="images/butterfly_paper.png" style="height:600px;"/>

<small>Pe'er, G., D. Saltz, and K. Frank, "Virtual corridors for conservation management," Conservation Biology **19**, 1997 (2005).</small>

*** .center

Open NetLogo and load "butterfly_odd.nlogo"

***
## Purpose

* Ecologists observe that as butterflies move uphill, they concentrate into narrow and well-definied "virtual corridors" rather than following any old path to the top of the hill.

* Explore the concept of "virtual corridors:" Can concentrations of migrating animals emerge spontaneously from movement 
behavior and topography, instead of being a special habitat?

* Specifically, How does the concentration of hill-topping butterflies emerge from:
    * How butterflies move uphill
    * Landscape topography

***
## Entities, State Variables, and Scales

* Landscape:
    * Square grid cells, with one *state variable*: **elevation**.
* Butterflies:
    * Have one *state variable*: **location**<br/>
    (discrete: which patch they're in)

***
## Entities, State Variables, and Scales

* Spatial Scale:
    * 150 &times; 150 cells
    * Corresponds to 25 &times; 25 meters in real landscape
    
* Time scale
    * Simulations last 1000 ticks
    * Tick length is unspecified (time for a butterfly to move one cell).

***
## Process Overview and Scheduling

* Only one process: butterfly movement
    * On each tick, each butterfly moves once
    * The order in which butterflies move is unimportant because they don't interact
    
***
## Design concepts (important ones)

* Emergence: results (concentration of butterflies in corridors) emerge from movement rule, topography
* Sensing: Butterflies can sense elevation in  current and 9 surrounding cells
* Interaction: None
* Stochasticity: Used to represent reasons why butterflies do not move straight uphill
* Observation: We need a way to measure of butterfly concentration

***
## Initialization

* Landscape: cell elevations set to flat landscape with two conical hills
* Butterflies: 500 are created and placed in one cell

<img src="images/hill_plan.png" style="width:500px;"/>

<img src="images/hill_elevation.png" style="width:500px;"/>

***
## Submodel: Butterfly movement

* Global parameter *q* is probability that butterfly moves straight uphill,<br/>
vs. moving to random neighbor cell.

<img src="images/butterfly_patches.jpg" style="height:500px;"/>
