---
title: "Interaction and Telemarketers"
class_no: 14
class_date: "Thurs. February 22"
qrimage: qrcode.png
qrbottom: '-90%'
pageurl: "ees4760.jgilligan.org/Slides/Class_14"
pdfurl: "ees4760.jgilligan.org/Slides/Class_14/EES_4760_5760_Class_14_Slides.pdf"
course      : "EES 4760/5760"
course_name : "Agent-Based & Individual-Based Computational Modeling"
author      : "Jonathan Gilligan"
semester    : Spring
year        : 2018
output:
  revealjs.jg::revealjs_presentation
---
```{r utility-functions, cache = F, echo = F, eval = T, message=F, warning=F}
knitr::opts_chunk$set(cache=FALSE, echo=FALSE, message=FALSE, warming=FALSE,
                      fig.height=8.5, fig.width=14, dpi=100,
                      dev='png',fig.path='assets/fig/',cache.path='./cache/')

find_semester_dir <- function(p = NULL) {
  if (is.null(p)) p <- getwd()
  p <- normalizePath(p)
  if (file.exists(file.path(p,'semester.yml'))) {
    return(p)
  } else {
    d <- dirname(p)
    if (d == p) return(NA)
    return(find_semester_dir(d))
  }
}

semester.dir <- find_semester_dir()
data.dir <- file.path(semester.dir, 'data')
script.dir <- file.path(semester.dir,'util_scripts')

source_semester_script <- function(script) {
  script_file <- file.path(script.dir, script)
  message("Running script", script_file)
  source(script_file, chdir = T)
}

eval_in_sem_script_dir <- function(expr, loc = script.dir) {
  this.dir <- getwd()
  setwd(loc)
  retval <- eval(expr)
  setwd(this.dir)
  invisible(retval)
}

data.dir <- 'assets/data'

library(tidyverse)
library(magrittr)
```
## Getting Started {#getting-started .eighty}

* Download the following files: 
  * NetLogo Testing Is Fun Library:
    * [jg-tif.nls](/models/class_14/jg-tif.nls)
  * NetLogo Models:
    * [telemarketer_class_14.nlogo](/models/class_14/telemarketer_class_14.nlogo)
    * [telemarketer_class_14.nlogo](/models/class_14/telemarketer_non_spatial_class_14.nlogo)
    * [telemarketer_mergers_class_14.nlogo](/models/class_14/telemarketer_mergers_class_14.nlogo)
    * [telemarketer_mergers_class_14.nlogo](/models/class_14/telemarketer_compare_class_14.nlogo)

# Telemarketer Model {#telemarketer-sec data-transition="fade-out" data-state="skip_slide"}

## Telemarketer Model {#telemarketer data-transition="fade-in"}

* Telemarketing firms interact
  * Telemarketer calls patches
    * \# patches proportional to size
    * Calls around 1/3 of patches in range
  * If patch has received a previous call that tick, it hangs up
  * If patch has not received a previous call that tick, it buys something
  * Interaction is indirect, mediated by patches
* Accounting:
  * Net profit = 2 &times; sales &minus; 50 &times; size
  * If balance < 0, firm goes bankrupt
* Growth
  * If balance > growth threshold, firm grows proportional to excess balance

# Results {#tm-results-sec data-transition="fade-out" data-state="skip_slide"}

## Results {#results data-transition="fade-in"}

```{r load-data, echo=F, include=T, message = F}
source_semester_script('analyze_telemarketer.R')
expt_data <- read_data(file.path(data.dir, 'telemarketer_class_14_vary_initial_telemarketers-table.csv')) %>% fix_names()
non_spatial_data <- read_data(file.path(data.dir, 'telemarketer_non-spatial_class_14_vary_initial_telemarketers-table.csv')) %>% fix_names()
merger_data <- read_data(file.path(data.dir, 'telemarketer_mergers_class_14_vary_initial_telemarketers-table.csv')) %>% fix_names()
comparison_data <- read_data(file.path(data.dir, 'telemarketer_compare_class_14_model_comparison-table.csv')) %>% fix_names() %>%
  mutate(condition = str_c(ifelse(limited_calls, "Spatial", "Nonspatial"), ", ", ifelse(mergers, "Mergers", "No mergers")))
```
```{r time-series, echo=F, include=T, message = F, fig.height=9}
plot_time_series(expt_data)
```

## Variation {#tm-variation}

```{r time-series-bands, echo=F, include=T, message = F, fig.height=9}
plot_time_series(expt_data, bands = TRUE)
```

## Median Weeks in Business {#tm-median-weeks}

```{r median-lifetime, echo=F, include=T, warning=F, fig.height=9}
plot_median_weeks(expt_data, max_weeks = 125, bands = TRUE)
```

# Non-Spatial Variant {#non-spatial-sec .center}


## Non-Spatial Variant {#non-spatial}

* As Wasellya develops, phone range increases.
* Telemarketers can call any patch
* How does this change things?

<!-- -->

* Add a switch to the interface called "limit-calls?"
* Change the code in the submodel `make-calls` from
  ```
  let customers patches in-radius r
  ```
  to
  ```
  let customers patches
  if limit-calls?
  [set customers patches in-radius r]
  ```

## Survival of Businesses {#non-spatial-time-series}

```{r non-spatial-time-series, echo=F, include=T, message = F, fig.height=9}
plot_time_series(non_spatial_data)
```

## Variation {#non-spatial-variation}

```{r non-spatial-time-series-bands, echo=F, include=T, message = F, fig.height=9}
plot_time_series(non_spatial_data, bands = TRUE)
```

## Median Weeks in Business {#non-spatial-median-weeks}

```{r non-spatial-median-lifetime, echo=F, include=T, warning=F, fig.height=9}
plot_median_weeks(non_spatial_data, max_weeks = 125, bands = TRUE)
```


# Mergers {#merger-sec data-transition="fade-out" data-state="skip_slide"}

## Mergers {#mergers data-transition="fade-in"}

* Instead of going bankrupt when the bank balance drops below 0, firms look for acquisition partner
  * Find a company that's bigger and has enough money to pay off deficit.
  * If it finds a parent, parent pays off deficit (child firm ends up with 0 balance)
  * In future turns, child pays parent 50% of its net profits.
  * In future, if child's balance becomes negative:
    * If parent has enough money, it pays child's deficit
    * If parent does not have enough money, child dies.


## Results {#merger-results}

```{r time-series-merger-bands, echo=F, include=T, fig.height=9}
plot_time_series(merger_data)
```

## Variation {#merger-variation}

```{r time-series-merger, echo=F, include=T, fig.height=9}
plot_time_series(merger_data, bands = TRUE)
```

## Median Weeks in Business {#merger-median-weeks}

```{r median-lifetime-merger, echo=F, include=T, warning=F, fig.height=9}
plot_median_weeks(merger_data, max_weeks = 125, bands = TRUE)
```


# Comparison of Models {.center}

## Comparison of Models

```{r model-comparison, echo=F, include=T, warning=F, message=F, fig.height=9}
plot_compare_median_weeks(comparison_data, max_weeks = 200, bands = TRUE) +
  theme(legend.position = c(0.01, 0.99), legend.justification = c(0,1))
```
